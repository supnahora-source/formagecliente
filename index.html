<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Age Fibra¬†|¬†Contrata√ß√£o</title>

<!-- Favicon -->
<link rel="icon" type="image/png" href="./logo-color.png">

<!-- Tipografia -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --age-orange:#ff6a00;
    --age-orange-2:#ff8a2b;
    --muted:#8f95a3;
    --bg:#fff7ef;
    --card-radius:12px;
    --transition:260ms;
    --max-width:1200px;
    font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    min-height:100vh;
    background:var(--bg);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  .shell{width:100%;max-width:var(--max-width)}
  .container{
    display:grid;
    grid-template-columns:1fr 420px;
    gap:18px;
    background:white;
    border-radius:14px;
    padding:20px;
    box-shadow:0 18px 60px rgba(12,18,35,0.06);
    position:relative;
  }
  .left{padding:18px;display:flex;flex-direction:column;gap:14px}
  .brand{display:flex;gap:12px;align-items:center}
  .logoBox{width:64px;height:64px;border-radius:10px;display:flex;align-items:center;justify-content:center}
  .logoBox img{width:56px;height:auto;display:block}
  .brandText h1{font-size:20px;color:#111;font-weight:800}
  .brandText p{font-size:13px;color:var(--muted)}
  .headline{font-size:24px;font-weight:800;color:#0b1220}
  .sub{color:#555;font-size:14px}
  .tagline{font-size:15px;color:#444;font-weight:500;margin-top:4px}

  /* Carrossel de planos */
  .plan-carousel{display:flex;gap:12px;overflow-x:auto;padding-top:12px;margin-bottom:12px}
  .plan-card{flex:0 0 200px;border:1px solid rgba(10,10,20,0.06);border-radius:12px;overflow:hidden;background:#fff;cursor:pointer;transition:transform var(--transition),box-shadow var(--transition),border-color var(--transition)}
  .plan-card.selected{border:2px solid var(--age-orange);transform:translateY(-6px);box-shadow:0 14px 40px rgba(255,106,0,0.18)}
  .plan-card img{width:100%;height:120px;object-fit:cover;display:block}
  .plan-card-content{padding:8px 10px;display:flex;flex-direction:column;gap:4px}
  .plan-card-title{font-size:15px;font-weight:600;color:#111}
  .plan-card-price{font-size:14px;color:#ff6a00;font-weight:700}

  /* Formul√°rio */
  .right{background:linear-gradient(180deg,#0d0f14,#0b0d12);color:#fff;padding:22px;border-radius:12px;min-width:300px;display:flex;flex-direction:column;gap:12px}
  .logo-dark{width:120px;height:auto;margin-bottom:6px;display:block}
  .form-title{font-size:20px;font-weight:700;letter-spacing:-0.3px}
  .form-sub{font-size:13px;color:rgba(255,255,255,0.85)}
  form{display:flex;flex-direction:column;gap:12px}
  label{font-size:13px;color:rgba(255,255,255,0.95);margin-bottom:4px}
  input[type="text"],input[type="email"],input[type="date"],select,input[type="tel"]{
    width:100%;padding:10px 12px;border-radius:10px;border:none;outline:none;font-size:14px;background:rgba(255,255,255,0.06);color:white;transition:background var(--transition),border var(--transition)
  }
  input[type="text"]:focus,input[type="email"]:focus,input[type="date"]:focus,select:focus,input[type="tel"]:focus{
    background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.12)
  }
  .light-select{background:white !important;color:#111 !important}
  .row{display:flex;gap:10px}
  .row .col{flex:1}
  @media (max-width:600px){.row{flex-direction:column;gap:8px}}
  .file-drop{border:1px dashed rgba(255,255,255,0.08);border-radius:10px;padding:10px;display:flex;gap:10px;align-items:center;cursor:pointer;background:rgba(255,255,255,0.02);transition:background var(--transition),border-color var(--transition)}
  .file-drop.drag{background:linear-gradient(90deg, rgba(255,106,0,0.06), rgba(255,106,0,0.02));border-color:rgba(255,106,0,0.32)}
  .file-drop:focus{outline:2px solid rgba(255,106,0,0.12)}
  .file-preview{display:flex;align-items:center;gap:10px;color:rgba(255,255,255,0.9)}
  .file-preview img{width:56px;height:40px;object-fit:cover;border-radius:6px;border:1px solid rgba(255,255,255,0.06)}
  .note{font-size:12px;color:rgba(255,255,255,0.72)}
  .actions{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:6px}
  .btn{background:linear-gradient(90deg,var(--age-orange),var(--age-orange-2));color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 12px 36px rgba(255,106,0,0.12);transition:transform 160ms,box-shadow 160ms;display:inline-flex;align-items:center;justify-content:center;gap:6px}
  .btn:hover:not([disabled]){box-shadow:0 18px 48px rgba(255,106,0,0.18);transform:translateY(-2px)}
  .btn:active:not([disabled]){transform:translateY(1px)}
  .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.08);color:white;font-weight:600}
  .btn.secondary:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.12)}
  .btn[disabled]{opacity:0.6;cursor:not-allowed;transform:none}
  .progress-wrap{width:100%;height:8px;background:rgba(255,255,255,0.04);border-radius:6px;overflow:hidden;margin-top:8px;display:none}
  .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--age-orange),var(--age-orange-2));transition:width 260ms linear}
  .inline-error{font-size:12px;color:#ffb4a6;margin-top:6px;display:none}
  .field-error{border:1px solid #ffb4a6 !important}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:#111;color:white;padding:10px 14px;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,0.3);opacity:0;pointer-events:none;transition:opacity 200ms}
  .toast.show{opacity:1;pointer-events:auto}
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:9999;opacity:0;pointer-events:none;transition:opacity 200ms}
  .modal.open{opacity:1;pointer-events:auto}
  .modal-card{width:92%;max-width:520px;background:white;border-radius:12px;padding:20px;box-shadow:0 20px 60px rgba(12,18,35,0.12)}
  .modal-card h2{margin-bottom:8px;font-size:20px;color:#111}
  .modal-card p{margin-bottom:16px;color:#333;line-height:1.4}
  /* Copyright centralizado */
  .copyright-badge{position:static;display:block;text-align:center;margin-top:24px;color:#bfbfc4;font-size:12px}
  @media (max-width:1024px){
    .container{grid-template-columns:1fr;gap:16px;padding:16px}
    .right{min-width:unset}
  }
  @media (max-width:600px){
    body{align-items:flex-start;justify-content:flex-start;padding:16px}
    .container{grid-template-columns:1fr;gap:12px;padding:12px;border-radius:0;box-shadow:none}
    .left{padding:12px;gap:12px}
    .right{padding:16px}
  }
</style>
</head>
<body>
  <div class="shell">
    <div class="container" role="application" aria-label="Contrata√ß√£o Age Fibra">
      <div class="left">
        <div class="brand">
          <div class="logoBox"><img src="./logo-color.png" alt="Age Fibra" onerror="this.style.display='none'"></div>
          <div class="brandText">
            <h1>Age Fibra¬†|¬†Contrata√ß√£o</h1>
            <p>Selecione um plano e preencha os dados.</p>
          </div>
        </div>
        <div>
          <div class="headline">Escolha o plano que combina com voc√™</div>
          <div class="sub">Explore os cart√µes abaixo para comparar pre√ßos e benef√≠cios.</div>
        </div>
        <!-- Carrossel de planos -->
        <div class="plan-carousel" id="planCarousel">
          <div class="plan-card" data-plan="Age Music" data-price="R$109,90">
            <img src="./age-music.jpg" alt="Age Music">
            <div class="plan-card-content">
              <div class="plan-card-title">Age Music</div>
              <div class="plan-card-price">R$109,90</div>
            </div>
          </div>
          <div class="plan-card" data-plan="Age Connect+" data-price="R$99,90">
            <img src="./age-connect.jpg" alt="Age Connect+">
            <div class="plan-card-content">
              <div class="plan-card-title">Age Connect+</div>
              <div class="plan-card-price">R$99,90</div>
            </div>
          </div>
          <div class="plan-card" data-plan="Age Prime Video" data-price="R$129,90">
            <img src="./age-prime.jpg" alt="Age Prime Video">
            <div class="plan-card-content">
              <div class="plan-card-title">Age Prime Video</div>
              <div class="plan-card-price">R$129,90</div>
            </div>
          </div>
          <div class="plan-card" data-plan="Age GloboPlay" data-price="R$129,90">
            <img src="./age-globo.jpg" alt="Age GloboPlay">
            <div class="plan-card-content">
              <div class="plan-card-title">Age GloboPlay</div>
              <div class="plan-card-price">R$129,90</div>
            </div>
          </div>
          <div class="plan-card" data-plan="Age Home Office" data-price="R$189,90">
            <img src="./age-homeoffice.jpg" alt="Age Home Office">
            <div class="plan-card-content">
              <div class="plan-card-title">Age Home Office</div>
              <div class="plan-card-price">R$189,90</div>
            </div>
          </div>
        </div>
        <!-- Fim Carrossel -->
      </div>
      <aside class="right">
        <img src="./logo-white.png" alt="Age Fibra" class="logo-dark" onerror="this.style.display='none'">
        <div>
          <div class="form-title">Dados do contratante</div>
          <div class="form-sub">Preencha para iniciarmos o processo</div>
        </div>
        <form id="signupForm" autocomplete="off" novalidate>
          <div>
            <label for="selectedPlanInput">Plano selecionado</label>
            <input type="text" id="selectedPlanInput" name="plan" placeholder="Escolha um plano..." readonly required>
          </div>
          <div class="row">
            <div class="col">
              <label for="nome">Nome completo</label>
              <input id="nome" name="nome" type="text" required>
              <div id="errNome" class="inline-error">Campo obrigat√≥rio</div>
            </div>
            <div class="col">
              <label for="cpf">CPF</label>
              <input id="cpf" name="cpf" type="text" maxlength="14" placeholder="000.000.000-00" required>
              <div id="errCPF" class="inline-error">CPF inv√°lido</div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <label for="nascimento">Data de nascimento</label>
              <input id="nascimento" name="nascimento" type="date" required>
              <div id="errNascimento" class="inline-error">Campo obrigat√≥rio</div>
            </div>
            <div class="col">
              <label for="telefone">Telefone (opcional)</label>
              <input id="telefone" name="telefone" type="tel" placeholder="+55 (61) 9xxxx-xxxx">
            </div>
          </div>
          <div class="row">
            <div class="col">
              <label for="cep">CEP</label>
              <input id="cep" name="cep" type="text" maxlength="9" placeholder="00000-000" required>
              <div id="errCEP" class="inline-error">CEP inv√°lido / n√£o encontrado</div>
            </div>
            <div class="col" style="flex:0 0 120px;">
              <label>&nbsp;</label>
              <button type="button" id="btnCep" class="btn secondary" style="width:100%">Buscar CEP</button>
            </div>
          </div>
          <div>
            <label for="logradouro">Logradouro (rua, bairro, cidade)</label>
            <input id="logradouro" name="logradouro" type="text" required>
            <div id="errLogradouro" class="inline-error">Campo obrigat√≥rio</div>
          </div>
          <div class="row">
            <div class="col">
              <label for="numero">Casa / Lote</label>
              <input id="numero" name="numero" type="text" required>
              <div id="errNumero" class="inline-error">Campo obrigat√≥rio</div>
            </div>
            <div class="col">
              <label for="complemento">Complemento</label>
              <input id="complemento" name="complemento" type="text">
              <div id="errComplemento" class="inline-error"></div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <label for="vencimento">Data de vencimento (fatura)</label>
              <select id="vencimento" name="vencimento" class="light-select" required>
                <option value="">Escolher</option>
                <option value="5">5</option>
                <option value="7">7</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
              <div id="errVenc" class="inline-error">Escolha uma op√ß√£o</div>
            </div>
            <div class="col">
              <label for="dia_instalacao">Dia preferido de instala√ß√£o</label>
              <select id="dia_instalacao" name="dia_instalacao" class="light-select" required>
                <option value="">Escolher</option>
                <option>Segunda</option>
                <option>Ter√ßa</option>
                <option>Quarta</option>
                <option>Quinta</option>
                <option>Sexta</option>
              </select>
              <div id="errDia" class="inline-error">Escolha uma op√ß√£o</div>
            </div>
          </div>
          <div>
            <label for="horario_instalacao">Hor√°rio preferido</label>
            <select id="horario_instalacao" name="horario_instalacao" class="light-select" required>
              <option value="">Escolher</option>
              <option>Manh√£ (08:00 - 12:00)</option>
              <option>Tarde (12:00 - 17:00)</option>
              <option>Noite (18:00 - 21:00)</option>
            </select>
            <div id="errHorario" class="inline-error">Escolha uma op√ß√£o</div>
          </div>
          <div>
            <label for="email">E-mail</label>
            <input id="email" name="email" type="email" required>
            <div id="errEmail" class="inline-error">E-mail inv√°lido</div>
          </div>
          <div>
            <label>Documento (RG ou CNH) ‚Äî JPG/PNG/PDF (m√°x 8MB)</label>
            <div id="fileDrop" class="file-drop" tabindex="0" aria-label="Arraste e solte o documento ou clique">
              <input id="fileInput" type="file" accept=".jpg,.jpeg,.png,.pdf" style="display:none">
              <div class="file-preview" id="filePreview">
                <div>
                  <div id="fileName" style="font-weight:700">Clique ou arraste o arquivo</div>
                  <div class="note">Aceitamos JPG, PNG ou PDF ‚Äî at√© 8MB</div>
                </div>
              </div>
            </div>
            <div id="errFile" class="inline-error">Arquivo inv√°lido</div>
          </div>
          <div class="progress-wrap" id="progressWrap" aria-hidden="true">
            <div class="progress-bar" id="progressBar" style="width:0%"></div>
          </div>
          <div class="actions">
            <div style="display:flex;flex-direction:column;gap:6px">
              <button id="submitBtn" class="btn" type="submit">
                <span id="submitSpinner" style="display:none">‚è≥</span>
                <span id="submitText">Enviar solicita√ß√£o</span>
              </button>
              <div id="statusMsg" class="inline-error" style="display:none;color:#ffd4bd"></div>
            </div>
            <button id="resetBtn" class="btn secondary" type="button">Limpar formul√°rio</button>
          </div>
        </form>
        <div class="copyright-badge">
          <svg viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M10 1.667A8.333 8.333 0 1 0 18.333 10 8.342 8.342 0 0 0 10 1.667Zm0 15A6.667 6.667 0 1 1 16.667 10 6.674 6.674 0 0 1 10 16.667Zm0-9.167A2.5 2.5 0 0 0 7.5 10a.833.833 0 1 0 1.666 0 .833.833 0 1 1 1.667 0A2.5 2.5 0 1 1 10 12.5a3.336 3.336 0 0 1-3.333-3.333.833.833 0 0 0-1.667 0A5 5 0 1 0 10 15a4.992 4.992 0 0 0 4.992-4.658A4.933 4.933 0 0 0 10 7.5Z"></path></svg>
          <span>Copyright feito por Jo√£o Vieira</span>
        </div>
      </aside>
    </div>
  </div>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document" aria-labelledby="modalTitle" aria-describedby="modalDesc">
      <h2 id="modalTitle">Solicita√ß√£o enviada com sucesso üéâ</h2>
      <p id="modalDesc">Recebemos sua solicita√ß√£o. Entraremos em contato em breve.</p>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="closeModal" class="btn secondary">Fechar</button>
        <button id="printReceipt" class="btn">Imprimir comprovante</button>
      </div>
    </div>
  </div>

<script>
const APPS_SCRIPT_ENDPOINT="YOUR_APPS_SCRIPT_WEBAPP_URL";const FILE_MAX_BYTES=8*1024*1024;function onlyDigits(s){return(s||'').toString().replace(/\\D/g,'');}function cpfMask(v){const d=onlyDigits(v).slice(0,11);if(d.length>9)return d.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/,'$1.$2.$3-$4');if(d.length>6)return d.replace(/(\\d{3})(\\d{3})(\\d{1,3})/,'$1.$2.$3');if(d.length>3)return d.replace(/(\\d{3})(\\d{1,3})/,'$1.$2');return d;}function validateCPF(cpf){cpf=onlyDigits(cpf);if(cpf.length!==11)return false;if(/^(.)\\1+$/.test(cpf))return false;const nums=cpf.split('').map(n=>+n);let sum=0;for(let i=0;i<9;i++)sum+=nums[i]*(10-i);let rev=11-(sum%11);if(rev>=10)rev=0;if(rev!==nums[9])return false;sum=0;for(let i=0;i<10;i++)sum+=nums[i]*(11-i);rev=11-(sum%11);if(rev>=10)rev=0;return rev===nums[10];}function cepMask(v){const d=onlyDigits(v).slice(0,8);if(d.length>5)return d.replace(/(\\d{5})(\\d{1,3})/,'$1-$2');return d;}const toastEl=document.getElementById('toast');let toastTimer=null;function showToast(msg,ms=3500){if(!msg)return;toastEl.textContent=msg;toastEl.classList.add('show');clearTimeout(toastTimer);toastTimer=setTimeout(()=>toastEl.classList.remove('show'),ms);}function showInlineError(el,msg){if(!el)return;el.textContent=msg||'';el.style.display=msg?'block':'none';}function setFieldError(inputEl,enable){if(!inputEl)return;if(enable)inputEl.classList.add('field-error');else inputEl.classList.remove('field-error');}
/* Plano carrossel */
const planCards=Array.from(document.querySelectorAll('.plan-card'));let currentCard=null;const selectedPlanInput=document.getElementById('selectedPlanInput');planCards.forEach(card=>{card.setAttribute('tabindex','0');card.addEventListener('click',()=>selectPlanCard(card));card.addEventListener('keypress',e=>{if(e.key==='Enter')selectPlanCard(card);});});function selectPlanCard(card){planCards.forEach(c=>c.classList.remove('selected'));currentCard=card;card.classList.add('selected');const title=card.dataset.plan||'';const price=card.dataset.price||'';selectedPlanInput.value=`${title} ‚Äî ${price}`;}
/* Campos e elementos */
const nomeField=document.getElementById('nome');const cpfField=document.getElementById('cpf');const nascimentoField=document.getElementById('nascimento');const cepField=document.getElementById('cep');const logradouroField=document.getElementById('logradouro');const numeroField=document.getElementById('numero');const complementoField=document.getElementById('complemento');const vencField=document.getElementById('vencimento');const diaField=document.getElementById('dia_instalacao');const horarioField=document.getElementById('horario_instalacao');const emailField=document.getElementById('email');const telefoneField=document.getElementById('telefone');const consentField=null;const btnCep=document.getElementById('btnCep');const fileDrop=document.getElementById('fileDrop');const fileInput=document.getElementById('fileInput');const filePreview=document.getElementById('filePreview');const fileNameEl=document.getElementById('fileName');const submitBtn=document.getElementById('submitBtn');const submitSpinner=document.getElementById('submitSpinner');const submitText=document.getElementById('submitText');const resetBtn=document.getElementById('resetBtn');const progressWrap=document.getElementById('progressWrap');const progressBar=document.getElementById('progressBar');const statusMsg=document.getElementById('statusMsg');const errNome=document.getElementById('errNome');const errCPF=document.getElementById('errCPF');const errNascimento=document.getElementById('errNascimento');const errCEP=document.getElementById('errCEP');const errLogradouro=document.getElementById('errLogradouro');const errNumero=document.getElementById('errNumero');const errComplemento=document.getElementById('errComplemento');const errVenc=document.getElementById('errVenc');const errDia=document.getElementById('errDia');const errHorario=document.getElementById('errHorario');const errEmail=document.getElementById('errEmail');const errFile=document.getElementById('errFile');
let currentFile=null;let activeXhr=null;
/* CEP */
btnCep.addEventListener('click',async()=>{const cepRaw=onlyDigits(cepField.value);showInlineError(errCEP,'');setFieldError(cepField,false);if(cepRaw.length!==8){showInlineError(errCEP,'CEP inv√°lido. Informe 8 d√≠gitos.');setFieldError(cepField,true);cepField.focus();return;}btnCep.disabled=true;btnCep.textContent='Buscando...';try{const resp=await fetch(`https://viacep.com.br/ws/${cepRaw}/json/`);if(!resp.ok)throw new Error('Erro rede');const data=await resp.json();if(data.erro){showInlineError(errCEP,'CEP n√£o encontrado.');setFieldError(cepField,true);cepField.focus();}else{const ender=`${data.logradouro||''} ${data.bairro||''} ${data.localidade||''} - ${data.uf||''}`.trim();logradouroField.value=ender;showInlineError(errCEP,'');setFieldError(cepField,false);}}catch(err){showInlineError(errCEP,'Erro ao buscar CEP. Tente novamente.');}finally{btnCep.disabled=false;btnCep.textContent='Buscar CEP';}});
cpfField.addEventListener('input',e=>e.target.value=cpfMask(e.target.value));cepField.addEventListener('input',e=>e.target.value=cepMask(e.target.value));
/* Upload */
function isValidFileType(file){if(!file)return false;const allowedM=['image/jpeg','image/png','application/pdf'];const allowedExt=['.jpg','.jpeg','.png','.pdf'];const name=(file.name||'').toLowerCase();const hasExt=allowedExt.some(ext=>name.endsWith(ext));const hasMime=allowedM.includes(file.type);return hasMime&&hasExt;}
function updatePreview(file){filePreview.querySelector('img')?.remove();filePreview.querySelector('svg')?.remove();fileNameEl.textContent='Clique ou arraste o arquivo';if(!file)return;fileNameEl.textContent=file.name;if(file.type.startsWith('image/')){const reader=new FileReader();reader.onload=()=>{const img=document.createElement('img');img.src=reader.result;img.alt='preview';filePreview.prepend(img);};reader.readAsDataURL(file);}else{const div=document.createElement('div');div.innerHTML='<svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" stroke="#fff" stroke-width="1.2"/></svg>';filePreview.prepend(div);}}
function handleFileSelect(){const f=fileInput.files[0];currentFile=null;showInlineError(errFile,'');setFieldError(fileInput,false);if(!f){updatePreview(null);return;}if(f.size>FILE_MAX_BYTES){showInlineError(errFile,'Arquivo maior que 8MB. Escolha outro arquivo.');fileInput.value='';currentFile=null;updatePreview(null);return;}if(!isValidFileType(f)){showInlineError(errFile,'Formato inv√°lido. S√≥ JPG, PNG ou PDF.');fileInput.value='';currentFile=null;updatePreview(null);return;}currentFile=f;updatePreview(f);}
fileDrop.addEventListener('click',()=>fileInput.click());fileInput.addEventListener('change',handleFileSelect);['dragenter','dragover'].forEach(evt=>fileDrop.addEventListener(evt,e=>{e.preventDefault();e.stopPropagation();fileDrop.classList.add('drag');}));['dragleave','drop'].forEach(evt=>fileDrop.addEventListener(evt,e=>{e.preventDefault();e.stopPropagation();fileDrop.classList.remove('drag');}));fileDrop.addEventListener('drop',e=>{if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){fileInput.files=e.dataTransfer.files;handleFileSelect();}});fileDrop.addEventListener('keypress',e=>{if(e.key==='Enter')fileInput.click();});
/* Valida√ß√£o */
function validateAll(){let ok=true;const nome=nomeField.value.trim();const cpf=cpfField.value.trim();const nasc=nascimentoField.value;const cep=cepField.value.trim();const log=logradouroField.value.trim();const num=numeroField.value.trim();const comp=complementoField.value.trim();const venc=vencField.value;const dia=diaField.value;const hor=horarioField.value;const email=emailField.value.trim();if(!nome){showInlineError(errNome,'Campo obrigat√≥rio');setFieldError(nomeField,true);ok=false;}else{showInlineError(errNome,'');setFieldError(nomeField,false);}if(!cpf||!validateCPF(cpf)){showInlineError(errCPF,'CPF inv√°lido');setFieldError(cpfField,true);ok=false;}else{showInlineError(errCPF,'');setFieldError(cpfField,false);}if(!nasc){showInlineError(errNascimento,'Campo obrigat√≥rio');setFieldError(nascimentoField,true);ok=false;}else{showInlineError(errNascimento,'');setFieldError(nascimentoField,false);}if(!cep||onlyDigits(cep).length!==8){showInlineError(errCEP,'CEP inv√°lido');setFieldError(cepField,true);ok=false;}else{showInlineError(errCEP,'');setFieldError(cepField,false);}if(!log){showInlineError(errLogradouro,'Campo obrigat√≥rio');setFieldError(logradouroField,true);ok=false;}else{showInlineError(errLogradouro,'');setFieldError(logradouroField,false);}if(!num){showInlineError(errNumero,'Campo obrigat√≥rio');setFieldError(numeroField,true);ok=false;}else{showInlineError(errNumero,'');setFieldError(numeroField,false);}if(!venc){showInlineError(errVenc,'Escolha uma op√ß√£o');setFieldError(vencField,true);ok=false;}else{showInlineError(errVenc,'');setFieldError(vencField,false);}if(!dia){showInlineError(errDia,'Escolha uma op√ß√£o');setFieldError(diaField,true);ok=false;}else{showInlineError(errDia,'');setFieldError(diaField,false);}if(!hor){showInlineError(errHorario,'Escolha uma op√ß√£o');setFieldError(horarioField,true);ok=false;}else{showInlineError(errHorario,'');setFieldError(horarioField,false);}if(!email||!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)){showInlineError(errEmail,'E-mail inv√°lido');setFieldError(emailField,true);ok=false;}else{showInlineError(errEmail,'');setFieldError(emailField,false);}if(!currentCard){showToast('Selecione um plano antes de enviar');ok=false;}return ok;}
/* Reset */
resetBtn.addEventListener('click',()=>{if(!confirm('Limpar todos os campos?'))return;form.reset();selectedPlanInput.value='';nomeField.value='';cpfField.value='';nascimentoField.value='';cepField.value='';logradouroField.value='';numeroField.value='';complementoField.value='';vencField.value='';diaField.value='';horarioField.value='';emailField.value='';telefoneField.value='';currentFile=null;fileInput.value='';updatePreview(null);progressBar.style.width='0%';progressWrap.style.display='none';statusMsg.style.display='none';planCards.forEach(c=>c.classList.remove('selected'));currentCard=null;[errNome,errCPF,errNascimento,errCEP,errLogradouro,errNumero,errComplemento,errVenc,errDia,errHorario,errEmail,errFile].forEach(e=>{if(e){e.textContent='';e.style.display='none';}});});
/* Envio via JSON + base64 */
form.addEventListener('submit',async(ev)=>{ev.preventDefault();if(activeXhr){showToast('H√° um envio em andamento. Aguarde.');return;}if(!validateAll())return;const payload={plan:currentCard?.dataset.plan||'',nome:nomeField.value.trim(),cpf:onlyDigits(cpfField.value),nascimento:nascimentoField.value,cep:onlyDigits(cepField.value),logradouro:logradouroField.value.trim(),numero:numeroField.value.trim(),complemento:complementoField.value.trim(),vencimento:vencField.value,dia_instalacao:diaField.value,horario_instalacao:horarioField.value,email:emailField.value.trim(),telefone:telefoneField.value.trim(),files:[]};if(currentFile){try{const b64=await new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=()=>{resolve(reader.result.split(',')[1]);};reader.onerror=reject;reader.readAsDataURL(currentFile);});payload.files.push({name:currentFile.name,mimeType:currentFile.type,data:b64});}catch(err){showToast('Erro ao preparar arquivo.');return;}}submitBtn.disabled=true;submitSpinner.style.display='inline';submitText.textContent='Enviando...';statusMsg.style.display='none';progressWrap.style.display='block';progressBar.style.width='4%';let fallbackTimer=setInterval(()=>{let w=parseInt(progressBar.style.width);w=Math.min(95,w+Math.random()*4);progressBar.style.width=w+'%';},400);try{const res=await fetch(APPS_SCRIPT_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});clearInterval(fallbackTimer);progressBar.style.width='100%';const data=await res.json().catch(()=>({}));if(res.ok&&data.status==='ok'){openSuccessModal();}else{showToast('Erro no servidor ao processar.');showInlineError(statusMsg,data.message||'Erro no servidor. Tente novamente.');statusMsg.style.display='block';}}catch(err){clearInterval(fallbackTimer);showToast('Erro de rede ao enviar. Verifique sua conex√£o.');}finally{submitBtn.disabled=false;submitSpinner.style.display='none';submitText.textContent='Enviar solicita√ß√£o';setTimeout(()=>{progressWrap.style.display='none';progressBar.style.width='0%';},800);}});
/* Modal */
const modal=document.getElementById('modal');const closeModal=document.getElementById('closeModal');const printReceipt=document.getElementById('printReceipt');let lastFocus=null;function openSuccessModal(){lastFocus=document.activeElement;modal.classList.add('open');modal.setAttribute('aria-hidden','false');const f=modal.querySelector('button,[href],input,select,textarea,[tabindex]:not([tabindex=\"-1\"])');if(f)f.focus();}
function closeSuccessModal(){modal.classList.remove('open');modal.setAttribute('aria-hidden','true');if(lastFocus)lastFocus.focus();}
closeModal.addEventListener('click',closeSuccessModal);printReceipt.addEventListener('click',()=>{const plan=selectedPlanInput.value||'‚Äî';const nome=nomeField.value.trim();const cpf=cpfField.value.trim();const nasc=nascimentoField.value;const cep=cepField.value.trim();const log=logradouroField.value.trim();const num=numeroField.value.trim();const comp=complementoField.value.trim();const email=emailField.value.trim();const tel=telefoneField.value.trim();const venc=vencField.value;const dia=diaField.value;const hor=horarioField.value;const now=new Date().toLocaleString();const html=\`<html><head><title>Comprovante</title><style>body{font-family:Arial,Helvetica,sans-serif;padding:20px;color:#111}h1{color:#ff6a00}.muted{color:#666;font-size:13px}</style></head><body><h1>Comprovante de solicita√ß√£o</h1><div class="muted">Data: \${now}</div><hr/><div><strong>Plano:</strong> \${plan}</div><div><strong>Nome:</strong> \${nome}</div><div><strong>CPF:</strong> \${cpf}</div><div><strong>Data de nascimento:</strong> \${nasc}</div><div><strong>CEP:</strong> \${cep}</div><div><strong>Logradouro:</strong> \${log}</div><div><strong>N√∫mero:</strong> \${num}</div><div><strong>Complemento:</strong> \${comp}</div><div><strong>E-mail:</strong> \${email}</div><div><strong>Telefone:</strong> \${tel}</div><div><strong>Vencimento:</strong> \${venc}</div><div><strong>Instala√ß√£o:</strong> \${dia} ‚Äî \${hor}</div><hr/><div class="muted">Obrigado por escolher a Age Fibra.</div><div style="margin-top:12px;font-size:12px;color:#888">¬© 2026 Jo√£o Vieira</div></body></html>\`;const w=window.open('','_blank','width=600,height=800');w.document.open();w.document.write(html);w.document.close();w.focus();setTimeout(()=>w.print(),400);});
</script>
</body>
</html>
